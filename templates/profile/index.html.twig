{% extends 'base.html.twig' %}

{% block title %}Profil -
	{{ user.pseudo }}
{% endblock %}

{% block body %}
	<div class="container mt-4">
		<h1 class="mb-3">{{ user.pseudo }}</h1>
		<p class="mt-3 text-white">Points de participation :
			<strong>{{ app.user.points }}</strong>
		</p>

		{# Onglets Bootstrap #}
		<ul class="nav nav-tabs" id="profileTabs" role="tablist">
			<li class="nav-item" role="presentation">
				<button class="nav-link active" id="pending-events-tab" data-bs-toggle="tab" data-bs-target="#pending-events" type="button" role="tab" aria-controls="pending-events" aria-selected="true">
					Mes événements en attente
				</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="created-events-tab" data-bs-toggle="tab" data-bs-target="#created-events" type="button" role="tab" aria-controls="created-events" aria-selected="false">
					Mes événements créés
				</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="favorites-tab" data-bs-toggle="tab" data-bs-target="#favorites" type="button" role="tab" aria-controls="favorites" aria-selected="false">
					Mes favoris
				</button>
			</li>
		</ul>

		<div
			class="tab-content mt-3" id="profileTabsContent">

			{# Événements en attente #}
			<div class="tab-pane fade show active" id="pending-events" role="tabpanel" aria-labelledby="pending-events-tab">
				{% if pendingEvents is not empty %}
					<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
						{% for event in pendingEvents %}
							<div class="col">
								{{ include('event/card.html.twig', { event: event, modifiableEventIds: modifiableEventIds, modalPrefix: 'profile', showDetailsButton: false }) }}
							</div>
						{% endfor %}
					</div>
				{% else %}
					<p class="mt-3 text-white">Vous n'avez aucun événement en attente de validation. Tenter l'expérience :
						<a href="{{ path('app_event_create') }}" class="btn btn-primary">
							<i class="fas fa-plus me-1"></i>
							Proposer un événement
						</a>
					</p>
				{% endif %}
			</div>

			{# Événements créés validés #}
			<div class="tab-pane fade" id="created-events" role="tabpanel" aria-labelledby="created-events-tab">
				{% set now = "now"|date("U") %}
				{% set ongoingEvents = approvedEvents|filter(event => event.startDateTime.timestamp <= now and event.endDateTime.timestamp >= now) %}
				{% set upcomingEvents = approvedEvents|filter(event => event.startDateTime.timestamp > now) %}
				{% set pastEvents = approvedEvents|filter(event => event.endDateTime.timestamp < now) %}

				{% for category, events in {'Événements en cours': ongoingEvents, 'Événements à venir': upcomingEvents, 'Événements passés': pastEvents} %}
					<h5 class="mt-4">{{ category }}</h5>
					{% if events|length > 0 %}
						<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mt-2">
							{% for event in events %}
								<div class="col">
									{{ include('event/card.html.twig', { event: event, modifiableEventIds: modifiableEventIds, modalPrefix: 'profile' }) }}
								</div>
							{% endfor %}
						</div>
					{% endif %}
					{% if not loop.last %}
						<hr class="my-4">
					{% endif %}
				{% endfor %}
			</div>

			{# Favoris #}
			<div class="tab-pane fade" id="favorites" role="tabpanel" aria-labelledby="favorites-tab">
				{% if favoriteEvents is not empty %}
					<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mt-2">
						{% for event in favoriteEvents %}
							<div class="col">
								{{ include('event/card.html.twig', { event: event, modifiableEventIds: modifiableEventIds, modalPrefix: 'favorites' }) }}

							</div>
						{% endfor %}
					</div>
				{% else %}
					<p class="mt-3 text-white">Vous n'avez aucun événement en favori.</p>
				{% endif %}
			</div>
		</div>
	</div>

	<style>
		.card:hover {
			box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
			transform: translateY(-4px);
			transition: all 0.2s ease-in-out;
			cursor: pointer;
			filter: brightness(0.98);
		}
		.event-card {
			min-height: 210px;
			border: 2px solid #3399ff;
		}
	</style>
{% endblock %}
